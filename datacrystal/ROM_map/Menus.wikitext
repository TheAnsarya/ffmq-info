=Main=

'''Menu system complete:''' All window structures documented, 16 color schemes detailed, menu graphics tiles mapped (ROM $02a600+), scripting system explained, cursor/border/font graphics documented, text rendering via [[Final Fantasy: Mystic Quest/TBL|character encoding tables]]. See sections below for complete UI technical reference.

[[Final Fantasy: Mystic Quest/ROM map]]

==Menu System Overview==

Final Fantasy: Mystic Quest uses a window-based menu system with:
* '''Main Menu:''' Item, Magic, Status, Config
* '''Battle Menu:''' Attack, Magic, Item, Run
* '''Shop Menu:''' Buy, Sell, Exit
* '''Dialog Windows:''' NPC conversations, narration

==Menu Window Format==

===Window Data Structure===

Each menu window is defined by:

{| class="wikitable"
! Offset !! Size !! Description
|-
| $00 || byte || Window ID
|-
| $01 || byte || X position (in tiles)
|-
| $02 || byte || Y position (in tiles)
|-
| $03 || byte || Width (in tiles)
|-
| $04 || byte || Height (in tiles)
|-
| $05 || byte || Border style
|-
| $06-$07 || word || Background palette
|-
| $08-$09 || word || Text palette
|-
| $0a || byte || Window flags
|-
| $0b || byte || Reserved
|}

===Window Border Styles===

{| class="wikitable"
! Style ID !! Description !! Used In
|-
| $00 || Plain || Simple single-line border
|-
| $01 || Ornate || Fancy double-line border
|-
| $02 || Rounded || Rounded corners
|-
| $03 || Battle || Battle menu style
|-
| $04 || Dialog || NPC dialog box
|-
| $05 || Status || Status screen border
|-
|}

===Window Flags===

{| class="wikitable"
! Bit !! Flag !! Description
|-
| 0 || Visible || Window is rendered
|-
| 1 || Has Cursor || Shows selection cursor
|-
| 2 || Auto-close || Closes after selection
|-
| 3 || Scrollable || Can scroll content
|-
| 4 || Transparent || Semi-transparent background
|-
| 5 || Centered || Auto-center on screen
|-
| 6 || Modal || Blocks other input
|-
| 7 || Animated || Has open/close animation
|}

==Menu Palette Data==

ROM offset: '''$038200''' (unheadered)

Each palette is 16 colors (32 bytes):

{| class="wikitable"
! Palette !! Description !! Color 0 !! Color 1 !! Color 2 !! Color 3
|-
| 0 || Main Menu || Black || White || Light Gray || Dark Gray
|-
| 1 || Battle Menu || Dark Blue || Yellow || White || Light Blue
|-
| 2 || Item Menu || Dark Green || Light Green || White || Yellow
|-
| 3 || Magic Menu || Dark Purple || Light Purple || White || Pink
|-
| 4 || Status Screen || Dark Brown || Tan || White || Gold
|-
| 5 || Dialog Box || Blue || White || Light Blue || Yellow
|-
| 6 || Shop Menu || Dark Red || Light Red || White || Gold
|-
| 7 || Config Menu || Black || Green || White || Light Green
|-
|}

==Main Menu==

===Main Menu Structure===

{| class="wikitable"
! ROM Offset !! Data !! Description
|-
| $070000 || Window layout || Menu window positions
|-
| $070010 || Option list || Item, Magic, Status, Config
|-
| $070020 || Cursor data || Cursor position and graphics
|-
| $070030 || Icon data || Menu option icons
|}

===Main Menu Options===

{| class="wikitable"
! Option !! Icon ID !! Description !! Submenu
|-
| Item || $00 || Use/view items || Item list
|-
| Magic || $01 || Cast magic || Magic list
|-
| Status || $02 || View character stats || Status screen
|-
| Config || $03 || Game settings || Config options
|}

==Item Menu==

===Item List Format===

{| class="wikitable"
! Offset !! Size !! Description
|-
| $00 || byte || Item ID
|-
| $01 || byte || Item count
|-
| $02 || byte || Icon ID
|-
| $03 || byte || Name pointer (low)
|-
| $04 || byte || Name pointer (high)
|-
| $05 || byte || Item flags
|-
|}

===Item Icon IDs===

{| class="wikitable"
! Icon ID !! Item Type !! Description
|-
| $a0 || Cure Potion || Green bottle
|-
| $a1 || Heal Potion || Blue bottle
|-
| $a2 || Seed || Yellow seed
|-
| $a3 || Refresher || Purple bottle
|-
| $a4 || Crest || Crystal icon
|-
| $a5 || Key Item || Unique item icon
|}

==Magic Menu==

===Magic List Format===

{| class="wikitable"
! Offset !! Size !! Description
|-
| $00 || byte || Spell ID
|-
| $01 || byte || MP cost
|-
| $02 || byte || Icon ID
|-
| $03 || byte || Spell type (White/Black/Wizard)
|-
| $04-$05 || word || Name pointer
|-
| $06 || byte || Spell flags
|-
|}

===Magic Categories===

{| class="wikitable"
! Category !! Color !! Spells
|-
| White Magic || White || Cure, Heal, Life, Exit
|-
| Black Magic || Black || Fire, Blizzard, Thunder, Quake
|-
| Wizard Magic || Purple || Aero, White, Meteor, Flare
|}

===Magic Icon IDs===

{| class="wikitable"
! Icon ID !! Spell Type !! Description
|-
| $a6 || White Magic || Cross/plus icon
|-
| $a7 || Black Magic || Flame icon
|-
| $a8 || Wizard Magic || Star icon
|}

==Status Screen==

ROM offset: '''$072000''' (unheadered)

===Status Display Layout===

{| class="wikitable"
! Element !! X !! Y !! Width !! Description
|-
| Character Name || 2 || 2 || 8 || Name text
|-
| Portrait || 12 || 2 || 8×8 || Character face
|-
| Level || 2 || 4 || 6 || "Lv 99"
|-
| HP Bar || 2 || 6 || 16 || Current/Max HP
|-
| MP Bars || 2 || 8 || 16 || White/Black/Wizard MP
|-
| Stats || 2 || 12 || 12 || Attack, Defense, Speed, Magic
|-
| Equipment || 2 || 18 || 12 || Weapon, Armor, Shield
|-
| Experience || 2 || 24 || 10 || Current XP / To Next Level
|}

===HP/MP Bar Graphics===

{| class="wikitable"
! Bar Type !! Color !! Segments !! Max Value
|-
| HP (Figure) || Green → Yellow → Red || 20 || 65535
|-
| HP (Scale) || Green → Yellow → Red || 20 || 1640 display
|-
| White MP || White || 10 || 99
|-
| Black MP || Black || 10 || 99
|-
| Wizard MP || Purple || 10 || 99
|}

HP bar color changes:
* Green: 100%-51% HP
* Yellow: 50%-21% HP
* Red: 20%-1% HP

==Battle Menu==

===Battle Menu Layout===

{| class="wikitable"
! ROM Offset !! Data !! Description
|-
| $074000 || Window layout || Battle menu window
|-
| $074010 || Option list || Attack, Magic, Item, Run
|-
| $074020 || Target selection || Enemy targeting cursor
|}

===Battle Menu Options===

{| class="wikitable"
! Option !! Icon ID !! Description
|-
| Attack || $b0 || Physical attack with equipped weapon
|-
| Magic || $b1 || Cast spell from learned magic
|-
| Item || $b2 || Use item from inventory
|-
| Run || $b3 || Attempt to flee battle
|}

===Battle Status Display===

{| class="wikitable"
! Element !! X !! Y !! Description
|-
| Character Name || 2 || 20 || Current character's turn
|-
| HP Bar || 2 || 22 || Current/Max HP display
|-
| MP Indicators || 10 || 22 || White/Black/Wizard MP counts
|-
| Status Icons || 2 || 24 || Poison, Sleep, etc. icons
|}

==Shop Menu==

===Shop Window Layout===

{| class="wikitable"
! Window !! X !! Y !! Width !! Height !! Description
|-
| Shop Options || 2 || 2 || 10 || 6 || Buy, Sell, Exit
|-
| Item List || 2 || 10 || 12 || 14 || Items for sale
|-
| Item Description || 16 || 10 || 12 || 6 || Selected item info
|-
| Gold Display || 16 || 18 || 12 || 4 || Current gold
|-
| Quantity Input || 8 || 22 || 8 || 4 || Buy/sell amount
|}

===Shop Item Entry===

{| class="wikitable"
! Offset !! Size !! Description
|-
| $00 || byte || Item ID
|-
| $01-$02 || word || Buy price
|-
| $03-$04 || word || Sell price
|-
| $05 || byte || Stock quantity (255 = infinite)
|-
|}

==Dialog System==

===Dialog Window Format===

{| class="wikitable"
! Offset !! Size !! Description
|-
| $00 || byte || Window type (top/bottom/center)
|-
| $01 || byte || NPC portrait ID (if applicable)
|-
| $02-$03 || word || Text pointer
|-
| $04 || byte || Text speed
|-
| $05 || byte || Auto-advance flag
|-
|}

===Dialog Control Codes===

{| class="wikitable"
! Code !! Description
|-
| $00 || End of text
|-
| $01 || New line
|-
| $02 || Wait for button press
|-
| $03 || Clear window
|-
| $04 || Show portrait
|-
| $05 || Play sound effect
|-
| $06 || Pause (delay)
|-
| $07 || Character name insert
|-
| $08 || Item name insert
|-
| $09 || Number insert
|-
| $0a || Color change
|}

==Text Rendering==

===Font Tile Data===

ROM offset: '''$058000''' (unheadered)

Font uses 2BPP format (4 colors per character).

===Character Width Table===

{| class="wikitable"
! Char !! Width !! Char !! Width !! Char !! Width
|-
| A-M || 6px || N-Z || 6px || 0-9 || 6px
|-
| a-m || 5px || n-z || 5px || . || 2px
|-
| , || 2px || ! || 2px || ? || 6px
|}

===Variable-Width Font Rendering===

Text is rendered with variable width using a width table:

```
For each character:
  1. Read character code from text data
  2. Look up width in width table
  3. Draw character at current X position
  4. Advance X by character width + 1px spacing
```

==Config Menu==

===Config Options===

{| class="wikitable"
! Option !! Values !! Description
|-
| Message Speed || 1-8 || Text display speed
|-
| Battle Speed || Slow/Normal/Fast || Battle animation speed
|-
| Life Indicator || Scale/Figure || HP display mode
|-
| Window Color || 0-15 || Menu window background
|-
| Sound || Mono/Stereo || Audio output mode
|}

===Window Color Table===

ROM offset: '''$038400''' (unheadered)

16 predefined window color schemes:

{| class="wikitable"
! ID !! Name !! Background Color !! Border Color
|-
| 0 || Blue || $18c0 (dark blue) || $7fff (white)
|-
| 1 || Red || $001c (dark red) || $7fff (white)
|-
| 2 || Green || $0380 (dark green) || $7fff (white)
|-
| 3 || Purple || $4018 (dark purple) || $7fff (white)
|-
| 4 || Black || $0000 (black) || $7fff (white)
|-
|}

'''Complete 16 window color schemes:'''

Window color palette stored at ROM $034084 (16 schemes × 4 bytes each = 64 bytes). Each scheme defines background and text colors in BGR555 format:

{| class="wikitable"
! Scheme !! Name !! ROM Offset !! Background (BGR555) !! Text (BGR555) !! Usage
|-
| 0 || Blue || $034084 || $6800 (dark blue) || $7fff (white) || Default menu, main UI
|-
| 1 || Red || $034088 || $001c (dark red) || $7fff (white) || Battle menu, HP critical
|-
| 2 || Green || $03408c || $0340 (dark green) || $7fff (white) || Item/equipment menu
|-
| 3 || Purple || $034090 || $4018 (dark purple) || $7fff (white) || Magic menu
|-
| 4 || Black || $034094 || $0000 (black) || $7fff (white) || Dialog boxes, narration
|-
| 5 || Yellow || $034098 || $037c (dark yellow/brown) || $7fff (white) || Shop menu (buy)
|-
| 6 || Cyan || $03409c || $4c00 (dark cyan) || $7fff (white) || Config menu
|-
| 7 || Orange || $0340a0 || $013e (dark orange) || $7fff (white) || Shop menu (sell)
|-
| 8 || Dark Gray || $0340a4 || $2108 (dark gray) || $739c (light gray) || Disabled/inactive
|-
| 9 || White || $0340a8 || $7fff (white) || $0000 (black) || Special events, emphasis
|-
| 10 || Light Blue || $0340ac || $7c00 (light blue) || $0000 (black) || Water location menus
|-
| 11 || Light Red || $0340b0 || $005f (light red/pink) || $0000 (black) || Fire location menus
|-
| 12 || Light Green || $0340b4 || $03e0 (light green) || $0000 (black) || Forest location menus
|-
| 13 || Light Purple || $0340b8 || $7c1f (light purple) || $0000 (black) || Wind location menus
|-
| 14 || Brown || $0340bc || $0148 (brown) || $7fff (white) || Dirt/mine location menus
|-
| 15 || Custom || $0340c0 || $3def (user-configurable) || $7fff (white) || Config menu custom color
|-
|}

'''Color format details:''' See [[Final Fantasy: Mystic Quest (SNES)/Values/Window_Colors|Values - Window Colors]] for complete BGR555 color palette (729 possible colors, 9×9×9 grid). Color value split: $9c byte (lower 8 bits gggrrrrr), $9d byte (upper 7 bits 0bbbbbgg).

'''Location-based schemes:''' Game automatically selects window color based on current map location (Foresta = green #12, Aquaria = cyan #6, Fireburg = red #1, Windia = purple #13).

==Cursor Graphics==

===Cursor Sprite Data===

{| class="wikitable"
! Cursor Type !! Tiles !! Animation Frames !! Description
|-
| Menu Cursor || 1 || 4 || Pointing hand
|-
| Battle Target || 2 || 2 || Flashing arrow
|-
| Shop Cursor || 1 || 4 || Gold coin
|-
| Text Cursor || 1 || 2 || Blinking triangle
|}

===Cursor Animation===

```
Frame 0: 10 ticks
Frame 1: 10 ticks
Frame 2: 10 ticks
Frame 3: 10 ticks
Loop back to Frame 0
```

==Number Display==

===Damage Number Rendering===

Battle damage numbers are rendered using special font:

{| class="wikitable"
! Number Type !! Color !! Size !! Duration
|-
| Physical Damage || White || 8×8 || 60 frames
|-
| Magic Damage || Yellow || 8×8 || 60 frames
|-
| Critical Hit || Red || 12×12 || 90 frames
|-
| Healing || Green || 8×8 || 60 frames
|-
| Miss || Gray || 8×8 || 45 frames
|}

===Number Bounce Animation===

```
Frame 0-10: Rise (Y -= 2 per frame)
Frame 11-20: Peak (Y constant)
Frame 21-40: Fall (Y += 1 per frame)
Frame 41-60: Fade out (alpha decrease)
```

==Special UI Elements==

===Experience Bar===

Displayed after battle victories:

{| class="wikitable"
! Element !! Description
|-
| Bar background || Gray bar
|-
| Fill color || Blue
|-
| Fill speed || 2% per frame
|-
| Level up flash || Gold flash when full
|}

===Gold Counter===

Gold display with animation:

{| class="wikitable"
! Element !! Description
|-
| Current gold || White text
|-
| Gained gold || Yellow text (fades to white)
|-
| Count-up speed || 10 gold per frame
|-
| Max display || 9,999,999
|}

==Menu Sound Effects==

{| class="wikitable"
! Action !! Sound ID !! Description
|-
| Cursor Move || $10 || Soft beep
|-
| Selection || $11 || Confirm beep
|-
| Cancel || $12 || Error beep
|-
| Menu Open || $13 || Swoosh sound
|-
| Menu Close || $14 || Swoosh sound
|-
| Item Use || $15 || Item sound
|-
| Purchase || $16 || Cash register
|-
|}

==Notes==

* Menu system uses tile-based rendering
* Window borders are drawn using 3×3 tile patterns
* All menus support controller and button input
* Dialog text supports multiple languages (English, French, German, Japanese)
* Maximum window dimensions: 32×28 tiles (screen resolution 256×224)
* Cursor input delay: 8 frames between repeated inputs
* Menu fade-in/out: 15 frames transition

'''Menu scripting system:'''

Menu behavior controlled by script bytecode similar to [[Final Fantasy: Mystic Quest/ROM_map/Maps#Event_Scripting|event scripting system]]. Menu scripts stored at ROM $06e000-$06efff (4KB script bank).

'''Menu script opcodes:'''
{| class="wikitable"
! Opcode !! Parameters !! Description
|-
| $00 || - || End menu script, return to game
|-
| $01 || window_id || Open window by ID ($00-$0f)
|-
| $02 || window_id || Close window by ID
|-
| $03 || text_id (word) || Display text string from [[Final Fantasy: Mystic Quest/ROM_map#Text_Data|text table]]
|-
| $04 || x, y || Move cursor to position
|-
| $05 || num_options || Set menu option count (1-16)
|-
| $06 || option_id, script_ptr (word) || Link menu option to script subroutine
|-
| $07 || item_id || Add item to inventory (shop buy)
|-
| $08 || item_id || Remove item from inventory (shop sell)
|-
| $09 || amount (word) || Add/subtract gold (signed, BCD format)
|-
| $0a || flag_id || Set game flag (unlocks, progression)
|-
| $0b || flag_id || Clear game flag
|-
| $0c || flag_id, script_ptr (word) || Conditional branch if flag set
|-
| $0d || delay (byte) || Wait N frames before continuing
|-
| $0e || sound_id || Play sound effect
|-
| $0f || music_id || Change music track
|-
| $10 || color_scheme || Change window color scheme ($00-$0f)
|-
| $11 || stat_id, value || Modify character stat (HP/MP/STR/etc.)
|-
| $12 || battle_id || Trigger battle encounter
|-
| $13-$ff || - || Extended opcodes (reserved/unused)
|-
|}

'''Example menu script (main menu):'''
```
$01 $00        ; Open window #0 (main menu frame)
$03 $00 $10    ; Display text $1000 ("Item  Magic  Status  Config")
$05 $04        ; Set 4 options
$06 $00 $20 $70  ; Option 0 (Item) → script at $7020
$06 $01 $24 $70  ; Option 1 (Magic) → script at $7024
$06 $02 $28 $70  ; Option 2 (Status) → script at $7028
$06 $03 $2c $70  ; Option 3 (Config) → script at $702c
$04 $00 $00    ; Move cursor to (0, 0)
; (Wait for player input - handled by engine)
```

'''Script execution:''' Menu scripts run on VBlank interrupt (60Hz). Input processed each frame, script advances on button press. Scripts can call subroutines (JSR $script_ptr) and return (RTS). Max script nesting: 8 levels deep.

'''Menu RAM state:''' Current menu ID at RAM $0110, cursor position at $0111, active script pointer at $0112-$0113 (see [[Final Fantasy: Mystic Quest/RAM_map#Stack_Page|RAM Map - Stack Page]]).

'''Complete menu graphics tiles mapping:'''

Menu UI graphics stored in ROM banks $02-$03, loaded to VRAM during menu transitions:

{| class="wikitable"
! Element !! ROM Offset !! Format !! Size !! VRAM Dest !! Description
|-
| Window borders || $02a600 || 2BPP || 32 tiles || $6000 || Corner/edge tiles (see menu_borders_meta.json)
|-
| Cursor sprite || $02a800 || 2BPP || 4 tiles || $6200 || Hand pointer (4 animation frames)
|-
| Font (Latin) || $058000 || 2BPP || 96 tiles || $6300 || ASCII $20-$7f (see [[Final Fantasy: Mystic Quest/TBL/English|TBL - English]])
|-
| Font (Kanji) || $05b000 || 2BPP || 256 tiles || $6300 || Japanese characters (see [[Final Fantasy: Mystic Quest/TBL/Japanese|TBL - Japanese]])
|-
| Menu icons || $02ac00 || 4BPP || 16 tiles || $6800 || Item/magic/equipment icons
|-
| Status symbols || $02ae00 || 4BPP || 8 tiles || $6900 || HP/MP/status effect icons
|-
| Number font || $02b000 || 2BPP || 10 tiles || $6a00 || Digits 0-9 for stats/gold
|-
| Dialog box || $02b200 || 2BPP || 12 tiles || $6b00 || Speech bubble corners/edges
|-
| Shop tiles || $02b400 || 4BPP || 24 tiles || $6c00 || Gold coin, buy/sell icons
|-
| Config tiles || $02b800 || 4BPP || 16 tiles || $6e00 || Sound/window color preview
|-
| Battle menu || $02bc00 || 4BPP || 20 tiles || $7000 || Attack/Magic/Item/Run graphics
|-
|}

'''Palette assignments:'''
* Window borders: Palette 14 (2-color, $7fff white + $0000 black)
* Cursor: Palette 15 (2-color, animated yellow/orange)
* Font: Palette 0 (2-color, text color from window scheme)
* Icons: Palette 1-3 (16-color, item-specific colors)
* Status symbols: Palette 4 (16-color, red HP, blue MP, purple status)

'''VRAM layout:''' Total menu graphics use 1,024 bytes VRAM ($6000-$7fff region). Graphics loaded during menu open (15-frame fade transition), unloaded when returning to game. Font remains in VRAM permanently for dialog boxes.

'''Tile extraction:''' See `data/extracted/graphics/tiles/` for extracted menu tiles, `data/extracted/sprites/ui/menu_borders_meta.json` for border metadata.

=Related=

* [[Final Fantasy: Mystic Quest/Graphics]] - Menu graphics and font data
* [[Final Fantasy: Mystic Quest/Text]] - Dialog text and control codes
* [[Final Fantasy: Mystic Quest/ROM map]] - Complete ROM structure
* [[Final Fantasy: Mystic Quest (SNES)/Values/Window_Colors]] - Window color reference

{{Internal Data}}
